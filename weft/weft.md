# Wang-Engel temperature function (WEFT)

Wang-Engel temperature function[^1]: A simplified Arrhenius-type function, developed for responses to temperature and depending on minimum, optimum, and maximum temperatures (Wang et al., 2017)

<math xmlns="http://www.w3.org/1998/Math/MathML">
  <mi mathcolor="#000000">F</mi>
  <mfenced mathcolor="#000000" separators="|">
    <mrow>
      <mi mathcolor="#000000">T</mi>
    </mrow>
  </mfenced>
  <mo mathcolor="#000000">=</mo>
  <msup>
    <mrow>
      <mfenced mathcolor="#000000" separators="|">
        <mrow>
          <mfrac mathcolor="#000000">
            <mrow>
              <mn mathcolor="#000000">2</mn>
              <msup>
                <mrow>
                  <mfenced mathcolor="#000000" separators="|">
                    <mrow>
                      <msub>
                        <mrow>
                          <mi mathcolor="#000000">T</mi>
                        </mrow>
                        <mrow>
                          <mi mathcolor="#000000">d</mi>
                          <mi mathcolor="#000000">a</mi>
                          <mi mathcolor="#000000">y</mi>
                        </mrow>
                      </msub>
                      <mo mathcolor="#000000">-</mo>
                      <msub>
                        <mrow>
                          <mi mathcolor="#000000">T</mi>
                        </mrow>
                        <mrow>
                          <mi mathcolor="#000000">m</mi>
                          <mi mathcolor="#000000">i</mi>
                          <mi mathcolor="#000000">n</mi>
                        </mrow>
                      </msub>
                    </mrow>
                  </mfenced>
                </mrow>
                <mrow>
                  <mi mathcolor="#000000">a</mi>
                </mrow>
              </msup>
              <msup>
                <mrow>
                  <mfenced mathcolor="#000000" separators="|">
                    <mrow>
                      <msub>
                        <mrow>
                          <mi mathcolor="#000000">T</mi>
                        </mrow>
                        <mrow>
                          <mi mathcolor="#000000">o</mi>
                          <mi mathcolor="#000000">p</mi>
                          <mi mathcolor="#000000">t</mi>
                        </mrow>
                      </msub>
                      <mo mathcolor="#000000">-</mo>
                      <msub>
                        <mrow>
                          <mi mathcolor="#000000">T</mi>
                        </mrow>
                        <mrow>
                          <mi mathcolor="#000000">m</mi>
                          <mi mathcolor="#000000">i</mi>
                          <mi mathcolor="#000000">n</mi>
                        </mrow>
                      </msub>
                    </mrow>
                  </mfenced>
                </mrow>
                <mrow>
                  <mi mathcolor="#000000">a</mi>
                </mrow>
              </msup>
              <mo mathcolor="#000000">-</mo>
              <msup>
                <mrow>
                  <mfenced mathcolor="#000000" separators="|">
                    <mrow>
                      <msub>
                        <mrow>
                          <mi mathcolor="#000000">T</mi>
                        </mrow>
                        <mrow>
                          <mi mathcolor="#000000">d</mi>
                          <mi mathcolor="#000000">a</mi>
                          <mi mathcolor="#000000">y</mi>
                        </mrow>
                      </msub>
                      <mo mathcolor="#000000">-</mo>
                      <msub>
                        <mrow>
                          <mi mathcolor="#000000">T</mi>
                        </mrow>
                        <mrow>
                          <mi mathcolor="#000000">m</mi>
                          <mi mathcolor="#000000">i</mi>
                          <mi mathcolor="#000000">n</mi>
                        </mrow>
                      </msub>
                    </mrow>
                  </mfenced>
                </mrow>
                <mrow>
                  <mn mathcolor="#000000">2</mn>
                  <mi mathcolor="#000000">a</mi>
                </mrow>
              </msup>
            </mrow>
            <mrow>
              <msup>
                <mrow>
                  <mfenced mathcolor="#000000" separators="|">
                    <mrow>
                      <msub>
                        <mrow>
                          <mi mathcolor="#000000">T</mi>
                        </mrow>
                        <mrow>
                          <mi mathcolor="#000000">o</mi>
                          <mi mathcolor="#000000">p</mi>
                          <mi mathcolor="#000000">t</mi>
                        </mrow>
                      </msub>
                      <mo mathcolor="#000000">-</mo>
                      <msub>
                        <mrow>
                          <mi mathcolor="#000000">T</mi>
                        </mrow>
                        <mrow>
                          <mi mathcolor="#000000">m</mi>
                          <mi mathcolor="#000000">i</mi>
                          <mi mathcolor="#000000">n</mi>
                        </mrow>
                      </msub>
                    </mrow>
                  </mfenced>
                </mrow>
                <mrow>
                  <mn mathcolor="#000000">2</mn>
                  <mi mathcolor="#000000">α</mi>
                </mrow>
              </msup>
            </mrow>
          </mfrac>
        </mrow>
      </mfenced>
    </mrow>
    <mrow>
      <mi mathcolor="#000000">β</mi>
    </mrow>
  </msup>
  <mi mathcolor="#000000"> </mi>
  <mo mathcolor="#000000">;</mo>
</math>


<math xmlns="http://www.w3.org/1998/Math/MathML">
  <mi mathcolor="#000000">a</mi>
  <mo mathcolor="#000000">=</mo>
  <mi mathcolor="#000000"> </mi>
  <mfrac mathcolor="#000000">
    <mrow>
      <mi mathcolor="#000000">l</mi>
      <mi mathcolor="#000000">n</mi>
      <mn mathcolor="#000000">2</mn>
    </mrow>
    <mrow>
      <mi mathcolor="#000000">l</mi>
      <mi mathcolor="#000000">n</mi>
      <mfenced mathcolor="#000000" separators="|">
        <mrow>
          <mfrac mathcolor="#000000">
            <mrow>
              <msub>
                <mrow>
                  <mi mathcolor="#000000">T</mi>
                </mrow>
                <mrow>
                  <mi mathcolor="#000000">m</mi>
                  <mi mathcolor="#000000">a</mi>
                  <mi mathcolor="#000000">x</mi>
                </mrow>
              </msub>
              <mo mathcolor="#000000">-</mo>
              <msub>
                <mrow>
                  <mi mathcolor="#000000">T</mi>
                </mrow>
                <mrow>
                  <mi mathcolor="#000000">m</mi>
                  <mi mathcolor="#000000">i</mi>
                  <mi mathcolor="#000000">n</mi>
                </mrow>
              </msub>
            </mrow>
            <mrow>
              <msub>
                <mrow>
                  <mi mathcolor="#000000">T</mi>
                </mrow>
                <mrow>
                  <mi mathcolor="#000000">o</mi>
                  <mi mathcolor="#000000">p</mi>
                  <mi mathcolor="#000000">t</mi>
                </mrow>
              </msub>
              <mo mathcolor="#000000">-</mo>
              <msub>
                <mrow>
                  <mi mathcolor="#000000">T</mi>
                </mrow>
                <mrow>
                  <mi mathcolor="#000000">m</mi>
                  <mi mathcolor="#000000">i</mi>
                  <mi mathcolor="#000000">n</mi>
                </mrow>
              </msub>
            </mrow>
          </mfrac>
        </mrow>
      </mfenced>
    </mrow>
  </mfrac>
  <mo mathcolor="#000000">,</mo>
  <mi mathcolor="#000000"> </mi>
  <mi mathcolor="#000000">β</mi>
  <mo mathcolor="#000000">=</mo>
  <mn mathcolor="#000000">0</mn>
  <mo mathcolor="#000000">~</mo>
  <mn mathcolor="#000000">1</mn>
</math>

[^1]: Three cardinal temperatures


Code for WETF:

=== "Python"

    ``` python
    # -----------------------------------------------
    # The Wang-Engel temperature function (WETF)
    # -----------------------------------------------
    @numba.jit(nopython=True)
    def calculate_wang_engel_temperature( Tday, Tmin, Topt, Tmax):
        if (Topt <= Tmin):
            y = 0
        else:
            alpha = math.log(2) / math.log((Tmax - Tmin)/(Topt - Tmin))
            beta = 1 
            y = ( (2 * (Tday - Tmin)**alpha * (Topt - Tmin)**alpha - (Tday - Tmin)**(2*alpha)) / (Topt - Tmin)**(2*alpha) )**beta
            #y = 0 if (Tday < Tmin) else y
            #y = 0 if (Tday > Tmax) else y
            y = np.where(((Tday < Tmin) | (Tday > Tmax) ), 0, y)
        return y

    @numba.jit(parallel=True) 
    def apply_WETF(col_Tday, Tmin, Topt, Tmax):
        n = len(col_Tday)
        result = np.empty(n, dtype="float64")
        assert len(col_Tday) == n
        for i in prange(n):
            result[i] = calculate_wang_engel_temperature(col_Tday[i], Tmin, Topt, Tmax)
        return result

    def compute_WETF(df, Tmin, Topt, Tmax):
        df["WETFTMAX"] = apply_WETF( df["Tdaymax"].to_numpy(), Tmin, Topt, Tmax )
        return df

    ```


=== "R"

    ``` R
    # The Wang–Engel temperature function
    calculate_wang_engel_temperature <- function( Tday, Tmin, Topt, Tmax) {
      if (Topt <= Tmin){
        y <- 0
      } else {
        alpha <- log(2) / log((Tmax - Tmin)/(Topt - Tmin))
        beta <- 1 
        y <- ( (2 * (Tday - Tmin)^alpha * (Topt - Tmin)^alpha - (Tday - Tmin)^(2*alpha)) / (Topt - Tmin)^(2*alpha) )^beta
        y <- if_else(Tday < Tmin, 0, y)
        y <- if_else(Tday > Tmax, 0, y)
      }
      return(y)
    }
    calculate_WETF_wrap <- function( Tday, Tmin, Topt, Tmax) {
      y <- vector("numeric", length (Tday)) 
      for (i in 1:length(Tday)) {
        y[[i]] <- calculate_wang_engel_temperature( Tday=Tday[[i]], Tmin, 
                                                    Topt=Topt, Tmax) 
      }
      return(y)
    }
    ```
    The whole R code can be found in the Github repository at `Rcode` folder.